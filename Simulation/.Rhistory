+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,color = lambda),size=3)
+ scale_color_brewer() + guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,color = lambda),size=3)
+ scale_color_brewer() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,color = lambda),size=3)
+ scale_colour_gradient() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,color = lambda),size=3)
+ scale_colour_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3)
+ scale_colour_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3)
+ scale_fill_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3)
+ scale_colour_gradient() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=2)
+ scale_colour_gradient() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=2,linetype=1)
+ scale_colour_gradient() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
?geom_point
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=2,stroke=1)
+ scale_colour_gradient() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=2,stroke=.1)
+ scale_colour_gradient() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=2,stroke=.01)
+ scale_colour_gradient() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=2,shape=21)
+ scale_colour_gradient() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=1,shape=21)
+ scale_colour_gradient() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=1,shape=21)
+ scale_colour_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=1,shape=21)
+ scale_colour_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=1,shape=21)
+ scale_fill_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
k = 1
fields_metadata$lambda[match(colnames(Lambda),fields_metadata$SiteYear)] = Lambda[2,]
(ggplot(states,aes(long,lat)) +
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=1,shape=21)
+ scale_fill_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) + ggtitle(k)+
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=1,shape=21)
+ scale_fill_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
k = 1
fields_metadata$lambda[match(colnames(Lambda),fields_metadata$SiteYear)] = Lambda[k,]
(ggplot(states,aes(long,lat)) + ggtitle(k)+
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-104,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=1,shape=21)
+ scale_fill_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) + ggtitle(k)+
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-100,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=1,shape=21)
+ scale_fill_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) + ggtitle(k)+
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 35,xlim = c(-100,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=1,shape=21)
+ scale_fill_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) + ggtitle(k)+
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 80, lat1 = 35,xlim = c(-100,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=1,shape=21)
+ scale_fill_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) + ggtitle(k)+
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 50, lat1 = 35,xlim = c(-100,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=1,shape=21)
+ scale_fill_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) + ggtitle(k)+
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-100,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=3,col=1,shape=21)
+ scale_fill_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
(ggplot(states,aes(long,lat)) + ggtitle(k)+
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-100,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=5,col=1,shape=21)
+ scale_fill_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
pdf(file.path(folder,'Lambda_maps_GY.pdf'))
for(k in 1:20)  {
fields_metadata$lambda[match(colnames(Lambda),fields_metadata$SiteYear)] = Lambda[k,]
(ggplot(states,aes(long,lat)) + ggtitle(k)+
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-100,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=5,col=1,shape=21)
+ scale_fill_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
}
dev.off()
pdf(file.path(folder,'Lambda_maps_GY.pdf'))
for(k in 1:20)  {
fields_metadata$lambda[match(colnames(Lambda),fields_metadata$SiteYear)] = Lambda[k,]
(p<-ggplot(states,aes(long,lat)) + ggtitle(k)+
geom_polygon(aes(group=group),fill=NA,size=.2,col=1) + theme_map() + coord_map("albers",  lat0 = 90, lat1 = 40,xlim = c(-100,-67))
# +geom_segment(data = cors_trait2,aes(x=Lon1,xend=Lon2,y=Lat1,yend=Lat2,color=cor),size=1)
# +geom_point(data = fields_metadata_start,aes(x=long,y=lat),size=1)
+geom_point(data = subset(fields_metadata,!is.na(lambda)),aes(x=long,y=lat,fill = lambda),size=5,col=1,shape=21)
+ scale_fill_gradient2() #+ guides(size = F) #limits = range(results_sum$MvLMM_effect)
)
print(p)
}
dev.off()
boxplot(t(Lambda))
rowSums(Lambda^2)
plot(rowSums(Lambda^2))
Y = as.matrix(fread('BLUP_matrices/Grain Yield_BLUPs.csv',data.table=F)[,-1])
dim(Y)
hist(rowSums(!is.na(Y)))
ggplot(data.frame(count = rowSums(!is.na(Y))),aes(x=count)) + geom_histogram()
ggplot(data.frame(count = rowSums(!is.na(Y))),aes(x=count)) + geom_histogram(fill='grey70')
ggplot(data.frame(count = rowSums(!is.na(Y))),aes(x=count)) + geom_histogram(fill='grey70',col=1)
ggplot(data.frame(Num_hybrids = rowSums(!is.na(Y))),aes(x=Num_hybrids)) + geom_histogram(fill='grey70',col=1)
ggplot(data.frame(Num_hybrids = rowSums(!is.na(Y))),aes(x=Num_hybrids)) + geom_histogram(fill='grey70',col=1)
ggplot(data.frame(Num_hybrids = rowSums(!is.na(Y))),aes(x=Num_hybrids)) + geom_histogram(fill='grey70',col=1) + ylab('# hubrids')
ggplot(data.frame(count = rowSums(!is.na(Y))),aes(x=count)) + geom_histogram(fill='grey70',col=1) + ylab('# trials')
ggplot(data.frame(count = colSums(!is.na(Y))),aes(x=count)) + geom_histogram(fill='grey70',col=1) + ylab('# hybrids')
ggplot(data.frame(count = colMeans(!is.na(Y))),aes(x=count)) + geom_histogram(fill='grey70',col=1) + ylab('% hybrids')
dim(crossprod(!is.na(Y)))
Image(crossprod(!is.na(Y)))
shared = crossprod(!is.na(Y))
ggplot(data.frame(count = shared[upper.tri(shared)]),aes(x=count)) + geom_histogram(fill='grey70',col=1) + ylab('% hybrids')
p1 = ggplot(data.frame(count = rowSums(!is.na(Y))),aes(x=count)) + geom_histogram(fill='grey70',col=1) + ylab('# trials')
p2 = ggplot(data.frame(count = colMeans(!is.na(Y))),aes(x=count)) + geom_histogram(fill='grey70',col=1) + ylab('% hybrids')
plot_grid(p1,p2,ncol=1)
p1 = ggplot(data.frame(count = rowSums(!is.na(Y))),aes(x=count)) + geom_histogram(fill='grey70',col=1) + xlab('# trials')
p2 = ggplot(data.frame(count = colMeans(!is.na(Y))),aes(x=count)) + geom_histogram(fill='grey70',col=1) + xlab('% hybrids')
plot_grid(p1,p2,ncol=1)
ggplot(data.frame(count = rowSums(!is.na(Y))),aes(x=count)) + geom_histogram(fill='grey70',col=1) + xlab('# trials')
ggplot(data.frame(count = rowSums(!is.na(Y))),aes(x=count)) + geom_histogram(fill='grey70',col=1) + xlab('# trials') + theme_cowplot()
ggplot(data.frame(count = colMeans(!is.na(Y))),aes(x=count)) + geom_histogram(fill='grey70',col=1) + xlab('% hybrids') + theme_cowplot()
ggplot(data.frame(count = rowMeans(!is.na(Y))),aes(x=count)) + geom_histogram(fill='grey70',col=1) + xlab('% trials') + theme_cowplot()
ggplot(data.frame(count = shared[upper.tri(shared)]),aes(x=count)) + geom_histogram(fill='grey70',col=1) + ylab('# shared hybrids')  + theme_cowplot()
x = c(3,3);y = c(1,1)
plot(x,y);abline(0,1);abline(mean(x)-mean(y))
plot(x,y);abline(0,1);abline(mean(x)-mean(y),1)
plot(x,y,xlim=c(-3,3),ylim=c(-3,3));abline(0,1);abline(mean(x)-mean(y),1)
x=c(3,1);y=c(1,-2)
plot(x,y,xlim=c(-3,3),ylim=c(-3,3));abline(0,1);abline(mean(x)-mean(y),1)
x-y
x=c(3,1);y=c(1,-1)
plot(x,y,xlim=c(-3,3),ylim=c(-3,3));abline(0,1);abline(mean(x)-mean(y),1)
rowMeans(cbind(x,y))
diff(rowMeans(cbind(x,y)))
plot(x,y,xlim=c(-3,3),ylim=c(-3,3));abline(0,1);abline(diff(rowMeans(cbind(x,y))),1)
x
y = c(1,1)
plot(x,y,xlim=c(-3,3),ylim=c(-3,3));abline(0,1);abline(diff(rowMeans(cbind(x,y))),1)
x = matrix(c(2,1,-1,-2))
x
crosprod(x)
crossprod(x)
tcrossprod(x)
Image(tcrossprod(x))
x2 = matrix(c(0,1,1.5,-.5))
Image(tcrossprod(x2))
tcrossprod(x2)
x2 = matrix(c(0.1,1,1.5,-.5))
tcrossprod(x2)
Image(tcrossprod(x2))
x2 = matrix(c(-1,1,1.5,-.5))
Image(tcrossprod(x2))
Image(tcrossprod(x2)+tcrossprod(x))
ps = lapply(unique(results_subset$trait),function(trait.) ggplot(subset(results_subset,trait == trait.),aes(y=MegaLMM,x=`GBLUP(env BLUPs)`)) + ggtitle(trait.)+
geom_point() + geom_abline(slope=1,intercept=0) +
scale_x_continuous(limits = c(-.25,1),breaks=seq(-.2,1,by=.2)) +
scale_y_continuous(limits = c(-.25,1),breaks=seq(-.2,1,by=.2)))
ps[[1]]
dim(subset(results_subset,trait == trait.))
head(subset(results_subset,trait == trait.))
dim(summ_results)
head(subset(results_subset,trait == trait.))
head(aggregate(cbind('MegaLMM','GBLUP(env BLUPs')~SiteYear,subset(results_subset,trait == trait.),FUN=mean))
head(aggregate(MegaLMM+`GBLUP(env BLUPs`~SiteYear,subset(results_subset,trait == trait.),FUN=mean))
head(aggregate(MegaLMM+`GBLUP(env BLUPs)`~SiteYear,subset(results_subset,trait == trait.),FUN=mean))
head(aggregate(cbind(MegaLMM,`GBLUP(env BLUPs)`)~SiteYear,subset(results_subset,trait == trait.),FUN=mean))
ps = lapply(unique(results_subset$trait),function(trait.) ggplot(aggregate(cbind(MegaLMM,`GBLUP(env BLUPs)`)~SiteYear,subset(results_subset,trait == trait.),FUN=mean),aes(y=MegaLMM,x=`GBLUP(env BLUPs)`)) + ggtitle(trait.)+
geom_point() + geom_abline(slope=1,intercept=0) +
scale_x_continuous(limits = c(-.25,1),breaks=seq(-.2,1,by=.2)) +
scale_y_continuous(limits = c(-.25,1),breaks=seq(-.2,1,by=.2)))
ps[[3]]
Image(!is.na(Y))
YNA = is.na(Y)+1
Image(YNA)
Image
?scale_fill_gradient2
YNA[1]
YNA[1]=1.1
Image(YNA)
length(unique(YNA))
YNA[1:10,1:10]
head(unique(YNA))
head(unique(c(YNA)))
length(unique(c(YNA)))
Image(YNA)
gg_color_hue <- function(n) {
hues = seq(15, 375, length = n + 1)
hcl(h = hues, l = 65, c = 100)[1:n]
}
gg_color_hue((2))
Image(YNA[1:20,1:30])
Image(YNA[1:20,1:30],low=gg_color_hue((2))[1],high=gg_color_hue((2))[2])
Image(YNA[1:20,1:30],mid=gg_color_hue((2))[1],high=gg_color_hue((2))[2])
Image(YNA[1:20,1:30],mid=gg_color_hue((2))[1],high=gg_color_hue((3))[3])
Image(YNA[1:20,1:30],mid=gg_color_hue((2))[1],high=gg_color_hue((1))[1])
Image(YNA[1:20,1:30],mid=gg_color_hue((2))[1],high="#56B1F7")
Image(YNA,mid=gg_color_hue((2))[1],high="#56B1F7")
Image(2-YNA,mid=gg_color_hue((2))[1],high="#56B1F7")
Image(3-YNA,mid=gg_color_hue((2))[1],high="#56B1F7")
library(cowplot)
library(ggplot2)
library(dplyr)
library(emmeans)
library(car)
library(plyr)
results_dirs = c(MODEM = 'Results_MODEM', At_1001 = 'Results_At_1001')
# results_dirs = c(MODEM = 'Results_ARD_test_MODEM')
set='Results_At_1001'
dir = results_dirs[set]
results = do.call(bind_rows,lapply(list.files(pattern = 'Times',path=dir,full.names = T),function(x) read.csv(x)))
results$Method = revalue(results$Method,c('BSFG'= 'MegaLMM'))
results$Method = factor(results$Method,levels = c('MegaLMM','MCMCglmm','MTG2','phenix'))
p_max = max(results$p)
(p0 <- ggplot(results,aes(x=p,y=X2)) +
scale_x_continuous(breaks = unique(results$p),trans = scales::log2_trans()) +
geom_boxplot(aes(color=Method,group=interaction(Method,p)))
)
save_plot(sprintf('%s_ESS.pdf',set),p0)
results$time2 = results$time
results$time2[results$Method == 'MCMCglmm'] = with(subset(results,Method == 'MCMCglmm'),time*5/7 + time*2/7*1000/X2)
results$time2[results$Method == 'MegaLMM'] = with(subset(results,Method == 'MegaLMM'),time*5/7 + time*2/7*1000/X2)
results$log_time2 = log2(results$time2)
results2 = aggregate(log_time2~Method+p,subset(results,Method != 'MegaLMM' & p %in% c(32,64)),FUN=mean)
results2 = rbind(results2,data.frame(
Method = c('MCMCglmm','MTG2'),p=512,
log_time2 = c(predict(lm(log_time2~log2(p),subset(results2,Method == 'MCMCglmm')),newdata = list(p=(512))),
predict(lm(log_time2~log2(p),subset(results2,Method == 'MTG2')),newdata = list(p=(512))))
# predict(lm(log_time2~log2(p),subset(results2,Method == 'phenix')),newdata = list(p=(512))))
))
results3 = data.frame(p = 2^c(9:13,log2(p_max)));results3$time2 = results3$p/max(results3$p)*10*3600
my_comma = function(x) {
scales::comma(x,accuracy = 0.001,trim = F)
}
exponential_funs = expand.grid(p = 2^(10:13),slope = c(3.4,0.5,1,2,3))
MegaLMM_1024 = exp(mean(log(subset(results,Method == 'MegaLMM' & p==exponential_funs$p[1])$time2)))
# MegaLMM_1024 = mean(subset(results,Method == 'MegaLMM' & p==exponential_funs$p[1])$time2)
exponential_funs$time2 = (exponential_funs$p/(2^10))^exponential_funs$slope*MegaLMM_1024
(p1 <- ggplot(results,aes(x=p,y=time2/3600))  + scale_y_log10(breaks = 10^(-4:10),labels = my_comma) +
scale_x_continuous(breaks = unique(results$p),trans = scales::log2_trans()) + ylab('Hours') + xlab('# traits') +
# geom_line(aes(color=Method,group=Method),stat = 'summary',fun.y = 'mean',size=1)
geom_smooth(aes(color=Method,group=Method),se=F)
+geom_line(data = results2,aes(x=p,y=(2^log_time2)/3600,color=Method,group=Method),linetype = 2,size=1)
# +geom_line(data = results3,color = 'red',linetype=2)
+ geom_line(data = subset(exponential_funs,slope <= 3),aes(group = slope),color = 'grey70')
+ geom_text(data = subset(exponential_funs,p == 2^13 & slope <= 3),aes(x=1.3*p,y=time2/3600,label = slope))
+ geom_text(data = subset(exponential_funs,p == 2^13 & slope > 3),aes(x=1.3*p,y=time2/3600,label = 'Rate'))
+geom_point(aes(color=Method,group=Method))
)
g_cors = do.call(bind_rows,lapply(list.files(pattern = 'Gcor',path=dir,full.names = T),function(x) cbind(x,read.csv(x))))
g_cors$method = factor(g_cors$method,levels = c('BSFG','MCMCglmm','MTG2','phenix','rrBLUP'),labels = c('MegaLMM','MCMCglmm','MTG2','phenix','rrBLUP'))
g_cors$g_cor3 = g_cors$MCMCglmm
# g_cors$g_cor3 = g_cors$sommer
# g_cors$g_cor3[g_cors$g_cor3>1] = NA
#  position = position_dodge(width = .2)
# (p2 <- ggplot(g_cors,aes(x=p,y=g_cor3)) +
#     stat_summary(aes(group = method,color=method),fun.y=mean,geom='line',position = position) +
#     stat_summary(aes(group = method,color=method),fun.ymin=function(x) mean(x)-sd(x)/sqrt(length(x))*2,fun.ymax=function(x) mean(x)+sd(x)/sqrt(length(x))*2,geom='errorbar',position = position) +
#     scale_x_continuous(breaks = unique(g_cors$p),trans = scales::log2_trans())
# )
g_cors$trait = factor(g_cors$trait)
g_cors$p2 = factor(g_cors$p)
m = lm((g_cor3) ~ method:p2+p2:trait,subset(g_cors,!is.na(g_cor3) & !is.infinite(g_cor3) &  method != 'BSFG2' & !is.na(trait)))
means = emmeans(m,specs = c('p2','method'))
means_summary = as.data.frame(summary(means))
means_summary$p = as.numeric(as.character(means_summary$p2))
methods = unique(means_summary$method)
position = position_dodge(width = .2)
(p2 <- ggplot(subset(means_summary,method != 'rrBLUP' & !is.na(emmean)),aes(x=p,y=emmean)) + ylab('Estimated prediction accuracy') + xlab('# traits') +
geom_errorbar(aes(color = method,ymin = lower.CL,ymax = upper.CL),position = position) +
geom_point(aes(color = method),position = position) +
geom_hline(yintercept=subset(means_summary,method == 'rrBLUP')$emmean[1]) +
# geom_line(aes(color = method,group = method),position = position,size=1) +
geom_smooth(aes(color=method,group=method),se=F) +
scale_x_continuous(breaks = unique(g_cors$p),trans = scales::log2_trans())
)
leg = get_legend(p1 + theme(legend.position = 'bottom'))
nl = theme(legend.position = 'none')
dir = results_dirs[set]
results = do.call(bind_rows,lapply(list.files(pattern = 'Times',path=dir,full.names = T),function(x) read.csv(x)))
results$Method = revalue(results$Method,c('BSFG'= 'MegaLMM'))
results$Method = factor(results$Method,levels = c('MegaLMM','MCMCglmm','MTG2','phenix'))
results$Method
results = do.call(bind_rows,lapply(list.files(pattern = 'Times',path=dir,full.names = T),function(x) read.csv(x)))
# results$Method = revalue(results$Method,c('BSFG'= 'MegaLMM'))
results$Method = factor(results$Method,levels = c('MegaLMM','MCMCglmm','MTG2','phenix'))
results$Method
head(results)
setwd("~/Box Sync/Grants/2019/USDA")
setwd("~/Box Sync/DER_projects/MegaLMM_papers/GP_paper/Analyses/Simulation")
dir = results_dirs[set]
results = do.call(bind_rows,lapply(list.files(pattern = 'Times',path=dir,full.names = T),function(x) read.csv(x)))
results$Method = revalue(results$Method,c('BSFG'= 'MegaLMM'))
head(results)
dir
set
results_dirs
set='At_1001'
dir = results_dirs[set]
results = do.call(bind_rows,lapply(list.files(pattern = 'Times',path=dir,full.names = T),function(x) read.csv(x)))
results$Method = revalue(results$Method,c('BSFG'= 'MegaLMM'))
results$Method = factor(results$Method,levels = c('MegaLMM','MCMCglmm','MTG2','phenix'))
p_max = max(results$p)
(p0 <- ggplot(results,aes(x=p,y=X2)) +
scale_x_continuous(breaks = unique(results$p),trans = scales::log2_trans()) +
geom_boxplot(aes(color=Method,group=interaction(Method,p)))
)
save_plot(sprintf('%s_ESS.pdf',set),p0)
results$time2 = results$time
results$time2[results$Method == 'MCMCglmm'] = with(subset(results,Method == 'MCMCglmm'),time*5/7 + time*2/7*1000/X2)
results$time2[results$Method == 'MegaLMM'] = with(subset(results,Method == 'MegaLMM'),time*5/7 + time*2/7*1000/X2)
results$log_time2 = log2(results$time2)
results2 = aggregate(log_time2~Method+p,subset(results,Method != 'MegaLMM' & p %in% c(32,64)),FUN=mean)
results2 = rbind(results2,data.frame(
Method = c('MCMCglmm','MTG2'),p=512,
log_time2 = c(predict(lm(log_time2~log2(p),subset(results2,Method == 'MCMCglmm')),newdata = list(p=(512))),
predict(lm(log_time2~log2(p),subset(results2,Method == 'MTG2')),newdata = list(p=(512))))
# predict(lm(log_time2~log2(p),subset(results2,Method == 'phenix')),newdata = list(p=(512))))
))
results3 = data.frame(p = 2^c(9:13,log2(p_max)));results3$time2 = results3$p/max(results3$p)*10*3600
my_comma = function(x) {
scales::comma(x,accuracy = 0.001,trim = F)
}
exponential_funs = expand.grid(p = 2^(10:13),slope = c(3.4,0.5,1,2,3))
MegaLMM_1024 = exp(mean(log(subset(results,Method == 'MegaLMM' & p==exponential_funs$p[1])$time2)))
# MegaLMM_1024 = mean(subset(results,Method == 'MegaLMM' & p==exponential_funs$p[1])$time2)
exponential_funs$time2 = (exponential_funs$p/(2^10))^exponential_funs$slope*MegaLMM_1024
(p1 <- ggplot(results,aes(x=p,y=time2/3600))  + scale_y_log10(breaks = 10^(-4:10),labels = my_comma) +
scale_x_continuous(breaks = unique(results$p),trans = scales::log2_trans()) + ylab('Hours') + xlab('# traits') +
# geom_line(aes(color=Method,group=Method),stat = 'summary',fun.y = 'mean',size=1)
geom_smooth(aes(color=Method,group=Method),se=F)
+geom_line(data = results2,aes(x=p,y=(2^log_time2)/3600,color=Method,group=Method),linetype = 2,size=1)
# +geom_line(data = results3,color = 'red',linetype=2)
+ geom_line(data = subset(exponential_funs,slope <= 3),aes(group = slope),color = 'grey70')
+ geom_text(data = subset(exponential_funs,p == 2^13 & slope <= 3),aes(x=1.3*p,y=time2/3600,label = slope))
+ geom_text(data = subset(exponential_funs,p == 2^13 & slope > 3),aes(x=1.3*p,y=time2/3600,label = 'Rate'))
+geom_point(aes(color=Method,group=Method))
)
g_cors = do.call(bind_rows,lapply(list.files(pattern = 'Gcor',path=dir,full.names = T),function(x) cbind(x,read.csv(x))))
g_cors$method = factor(g_cors$method,levels = c('BSFG','MCMCglmm','MTG2','phenix','rrBLUP'),labels = c('MegaLMM','MCMCglmm','MTG2','phenix','rrBLUP'))
g_cors$g_cor3 = g_cors$MCMCglmm
# g_cors$g_cor3 = g_cors$sommer
# g_cors$g_cor3[g_cors$g_cor3>1] = NA
#  position = position_dodge(width = .2)
# (p2 <- ggplot(g_cors,aes(x=p,y=g_cor3)) +
#     stat_summary(aes(group = method,color=method),fun.y=mean,geom='line',position = position) +
#     stat_summary(aes(group = method,color=method),fun.ymin=function(x) mean(x)-sd(x)/sqrt(length(x))*2,fun.ymax=function(x) mean(x)+sd(x)/sqrt(length(x))*2,geom='errorbar',position = position) +
#     scale_x_continuous(breaks = unique(g_cors$p),trans = scales::log2_trans())
# )
g_cors$trait = factor(g_cors$trait)
g_cors$p2 = factor(g_cors$p)
m = lm((g_cor3) ~ method:p2+p2:trait,subset(g_cors,!is.na(g_cor3) & !is.infinite(g_cor3) &  method != 'BSFG2' & !is.na(trait)))
means = emmeans(m,specs = c('p2','method'))
means_summary = as.data.frame(summary(means))
means_summary$p = as.numeric(as.character(means_summary$p2))
methods = unique(means_summary$method)
position = position_dodge(width = .2)
(p2 <- ggplot(subset(means_summary,method != 'rrBLUP' & !is.na(emmean)),aes(x=p,y=emmean)) + ylab('Estimated prediction accuracy') + xlab('# traits') +
geom_errorbar(aes(color = method,ymin = lower.CL,ymax = upper.CL),position = position) +
geom_point(aes(color = method),position = position) +
geom_hline(yintercept=subset(means_summary,method == 'rrBLUP')$emmean[1]) +
# geom_line(aes(color = method,group = method),position = position,size=1) +
geom_smooth(aes(color=method,group=method),se=F) +
scale_x_continuous(breaks = unique(g_cors$p),trans = scales::log2_trans())
)
(p1 <- ggplot(results,aes(x=p,y=time2/3600))  + scale_y_log10(breaks = 10^(-4:10),labels = my_comma) +
scale_x_continuous(breaks = unique(results$p),trans = scales::log2_trans()) + ylab('Hours') + xlab('# traits') +
# geom_line(aes(color=Method,group=Method),stat = 'summary',fun.y = 'mean',size=1)
geom_smooth(aes(color=Method,group=Method),se=F)
+geom_line(data = results2,aes(x=p,y=(2^log_time2)/3600,color=Method,group=Method),linetype = 2,size=1)
# +geom_line(data = results3,color = 'red',linetype=2)
+ geom_line(data = subset(exponential_funs,slope <= 3),aes(group = slope),color = 'grey70')
+ geom_text(data = subset(exponential_funs,p == 2^13 & slope <= 3),aes(x=1.3*p,y=time2/3600,label = slope))
+ geom_text(data = subset(exponential_funs,p == 2^13 & slope > 3),aes(x=1.3*p,y=time2/3600,label = 'Rate'))
+geom_point(aes(color=Method,group=Method))
)
(p1 <- ggplot(results,aes(x=p,y=time2/3600))  + scale_y_log10(breaks = 10^(-4:10),labels = my_comma) +
scale_x_continuous(breaks = unique(results$p),trans = scales::log2_trans()) + ylab('Hours') + xlab('# traits') +
# geom_line(aes(color=Method,group=Method),stat = 'summary',fun.y = 'mean',size=1)
geom_smooth(aes(color=Method,group=Method),se=F)
+geom_line(data = results2,aes(x=p,y=(2^log_time2)/3600,color=Method,group=Method),linetype = 2,size=1)
# +geom_line(data = results3,color = 'red',linetype=2)
# + geom_line(data = subset(exponential_funs,slope <= 3),aes(group = slope),color = 'grey70')
# + geom_text(data = subset(exponential_funs,p == 2^13 & slope <= 3),aes(x=1.3*p,y=time2/3600,label = slope))
# + geom_text(data = subset(exponential_funs,p == 2^13 & slope > 3),aes(x=1.3*p,y=time2/3600,label = 'Rate'))
+geom_point(aes(color=Method,group=Method)) + theme_cowplot()
)
(p1 <- ggplot(results,aes(x=p,y=time2/3600))  + scale_y_log10(breaks = 10^(-4:10),labels = my_comma) +
scale_x_continuous(breaks = unique(results$p),trans = scales::log2_trans()) + ylab('Hours') + xlab('# traits') +
# geom_line(aes(color=Method,group=Method),stat = 'summary',fun.y = 'mean',size=1)
geom_smooth(aes(color=Method,group=Method),se=F)
+geom_line(data = results2,aes(x=p,y=(2^log_time2)/3600,color=Method,group=Method),linetype = 2,size=1)
# +geom_line(data = results3,color = 'red',linetype=2)
# + geom_line(data = subset(exponential_funs,slope <= 3),aes(group = slope),color = 'grey70')
# + geom_text(data = subset(exponential_funs,p == 2^13 & slope <= 3),aes(x=1.3*p,y=time2/3600,label = slope))
# + geom_text(data = subset(exponential_funs,p == 2^13 & slope > 3),aes(x=1.3*p,y=time2/3600,label = 'Rate'))
+geom_point(aes(color=Method,group=Method)) + theme_cowplot() + background_grid(major = 'xy')
)
